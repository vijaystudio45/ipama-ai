{% extends layout %}
 {% load i18n %} 
 {% block title %}
 {% translate "Signup" %}
 {% endblock %}
 {% block content %}

<!--begin::Form-->
<form id="kt_new_password_form" class="form w-100" method="POST" data-reset-password-url="{% url 'auth:password_reset_confirm' user_id=user_id %}" data-kt-redirect-url="/signin" data-signin-url="{% url 'auth:signin' %}">
  <!--begin::Heading-->
  {% csrf_token %}
  <div class="text-center mb-10">
    <!--begin::Title-->
    <h1 class="text-gray-900 fw-bolder mb-3">Setup New Password</h1>
    <!--end::Title-->

    <!--begin::Link-->
    <div class="text-gray-500 fw-semibold fs-6">
      Have you already reset the password ?

      <a href="/signin" class="link-primary fw-bold"> Sign in </a>
    </div>
    <!--end::Link-->
  </div>
  <!--begin::Heading-->

  <!--begin::Input group-->
  <div class="fv-row mb-8" data-kt-password-meter="true">
    <!--begin::Wrapper-->
    <div class="mb-1">
      <!--begin::Input wrapper-->
      <div class="position-relative mb-3">
        <input
          class="form-control bg-transparent"
          type="password"
          placeholder="Password"
          name="password"
          autocomplete="off"
        />

        <span
          class="btn btn-sm btn-icon position-absolute translate-middle top-50 end-0 me-n2"
          data-kt-password-meter-control="visibility"
        >
          <i class="bi bi-eye-slash fs-2"></i>

          <i class="bi bi-eye fs-2 d-none"></i>
        </span>
        <span class="validation-message" id="passwordValidation"></span>
      </div>
      <!--end::Input wrapper-->

      <!--begin::Meter-->
      <div
        class="d-flex align-items-center mb-3"
        data-kt-password-meter-control="highlight"
      >
        <div
          class="flex-grow-1 bg-secondary bg-active-success rounded h-5px me-2"
        ></div>
        <div
          class="flex-grow-1 bg-secondary bg-active-success rounded h-5px me-2"
        ></div>
        <div
          class="flex-grow-1 bg-secondary bg-active-success rounded h-5px me-2"
        ></div>
        <div
          class="flex-grow-1 bg-secondary bg-active-success rounded h-5px"
        ></div>
      </div>
      <!--end::Meter-->
    </div>
    <!--end::Wrapper-->

    <!--begin::Hint-->
    <div class="text-muted">
      Use 8 or more characters with a mix of letters, numbers & symbols.
    </div>
    <!--end::Hint-->
  </div>
  <!--end::Input group--->

  <!--end::Input group--->
  <div class="fv-row mb-8">
    <!--begin::Repeat Password-->
    <input
      type="password"
      placeholder="Repeat Password"
      name="confirm-password"
      autocomplete="off"
      class="form-control bg-transparent"
    />
    <span class="validation-message" id="confirmPasswordValidation"></span>

    <!--end::Repeat Password-->
  </div>
  <!--end::Input group--->

  <!--begin::Input group--->
  <div class="fv-row mb-8">
    <label class="form-check form-check-inline">
      <input class="form-check-input" type="checkbox" name="toc" value="1" />

      <span class="form-check-label fw-semibold text-gray-700 fs-6 ms-1">
        I Agree &
        <a href="#" class="ms-1 link-primary">Terms and conditions</a>.
      </span>
    </label>
    <span class="validation-message" id="tocValidation"></span>
  </div>
  <!--end::Input group--->

  <!--begin::Action-->
  <div class="d-grid mb-10">
    <button type="submit" id="kt_new_password_submit" class="btn btn-lg btn-primary w-100 mb-5">
      <span class="indicator-label">Reset Password</span>
      <span class="indicator-progress"
        >Please wait...
        <span class="spinner-border spinner-border-sm align-middle ms-2"></span
      ></span>
    </button>
  </div>
  <!--end::Action-->
</form>

<!-- <script>
    $(document).ready(function () {
        $("form").submit(function (e) {
            e.preventDefault();
            // Clear previous validation messages
            $(".validation-message").text("");

            // Perform client-side validation
            var password = $("input[name='password']").val();
            var confirmPassword = $("input[name='confirm-password']").val();
            var toc = $("input[name='toc']").prop("checked");
            var errors = [];

            if (!password) {
                errors.push("Password is required");
                $("#passwordValidation").text("Password is required");
            }

            if (password.length < 8) {
                errors.push("Password should be at least 8 characters");
                $("#passwordValidation").text("Password should be at least 8 characters");
            }

            if (password !== confirmPassword) {
                errors.push("Passwords do not match");
                $("#confirmPasswordValidation").text("Passwords do not match");
            }

            if (!toc) {
                errors.push("You must agree to the terms and conditions");
                $("#tocValidation").text("You must agree to the terms and conditions");
            }

            // Display all errors together
            if (errors.length > 0) {
                // Show a SweetAlert error popup with OK button
                var errorList = $("<ul>");

                errors.forEach(function (error) {
                    errorList.append($("<li>").text(error));
                });
                Swal.fire({
                            icon: 'error',
                            title: 'Sorry,looks like there are some errors detected, please try again!',
							showConfirmButton: true,
                            confirmButtonText: 'OK,got it!',
                        });
                return;  // Stop form submission if there are errors
            }

            // Get form data
            var formData = $(this).serialize();

            // Ajax request
            $.ajax({
                type: "POST",
                url: "{% url 'auth:password_reset_confirm' user_id=user_id %}", // Replace with your server endpoint
                data: formData,
                success: function (response) {
                    // Check if the API response is true
                    if (response) {
                        // Show a SweetAlert success popup
                        Swal.fire({
                            icon: 'success',
                            title: response.message,
                            showConfirmButton: false,
                            timer: 1500
                        });

                        // Optionally, you can redirect the user or perform other actions
						setTimeout(() => {
							window.location.href = "/signin"; // Example: Redirect to the dashboard
						}, 1500);
                    }
                },
                error: function (error) {
                    // Handle errors
                    console.log(error);
                }
            });
        });

        // Add event listener to clear validation messages on input
        $("input[name='password']").on('input', function () {
            $("#passwordValidation").text("");
        });

        $("input[name='confirm-password']").on('input', function () {
            $("#confirmPasswordValidation").text("");
        });

        $("input[name='toc']").on('input', function () {
            $("#tocValidation").text("");
        });
    });
</script> -->
<!--end::Form-->

{% endblock content %}
